<!DOCTYPE html>
<html>
<head>
  <title></title>
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110211149-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-110211149-1');
  </script>
  <meta property="og:image" content="http://puppysignal.com/static/img/static_contents_1.png"/>
  <meta name="description" content="내게 맞는 강아지를 찾아보세요.">
  <meta property="og:type" content="website">
  <meta property="og:title" content="퍼피시그널">
  <meta property="og:description" content="내게 맞는 강아지를 찾아보세요.">
  <meta property="og:url" content="http://puppysignal.com">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <meta charset="utf-8">
    <style>
    @import url(http://fonts.googleapis.com/earlyaccess/hanna.css);

    *{
      font-family: 'Hanna', serif;
    }
    @media (min-width:750px) {
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #floating-panel {
        position: absolute;
        top: 10px;
        left: 50%;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;
      }
    }

    @media (max-width:750px) {
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100vw;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #floating-panel {
        position: absolute;
        top: 10px;
        left: 25%;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;
      }
    }

    </style>
  <style type="text/css">
  @media (min-width:750px) {
    /*  상단 고정 메뉴바 css  */
  
    .top{
      width: 100%;
      position: fixed;     /*  화면상 위치 고정  */
      z-index: 6;          /*  z값 결정  */
      top : 0;
      height: 5vw;
      background-color: white;
    }

    .top_logo{
      position: relative;
      margin-top: 0.5vw;
      margin-left: 50%;
      -webkit-transform: translate(-50%, 0%);
      -ms-transform: translate(-50%, 0%);
      -moz-transform: translate(-50%, 0%);
      -o-transform: translate(-50%, 0%);
      transform: translate(-50%, 0%);
      width: 30%;
      text-align: center;
      font-weight: 900;
    }
    .top_nav{  
      position: relative;
      /*margin-top: 3%;*/    /*  top 여백 설정  */
      width: 50%;
      margin-left: 50%;
      -webkit-transform: translate(-50%, 0%);
      -ms-transform: translate(-50%, 0%);
      -moz-transform: translate(-50%, 0%);
      -o-transform: translate(-50%, 0%);
      transform: translate(-50%, 0%);
      text-align: center;
      margin-top: 1%;
    }
    .menu{
      margin-left: 0.5vw;
      margin-right: 0.5vw;
      color: black;
      font-size: 1vw;
      font-weight: 900;
    }
    .menu:hover {
      font-weight: 900;
      font-size: 1vw;
    }
    .top_logo_img{
      width: 14vw;
      height: 2vw;
      margin: 0;
    }
    .menu_slash{
      color: #BDBDBD;
      font-size: 1vw;
    }
    .top_logo_txt{
      font-size: 2vw;
      font-family: 'Clicker Script', cursive;
      color: #B5996D;
    }

    .top_nav a{
      text-decoration: none;
    }

    .top_title{
      width: 100%;
      background-color: white;
      height: 5vw;
    }

    .logo_img_div{
      width: 80%;
      height: 100%;
      background-color: white;
      margin: auto;
      margin-top: 5%;
    }

    html{
    font-size: 62.5%;
  }

  body{
    margin: 0;
  }

/*  end   */
/*  middle  */
  .middle{
    width: 100%;
    height: 70vw;
    background-color: transparent;
    position: relative;
  }

  .map_div{
    position: relative;
    width: 100%;
    height: 20vw;
    background-color: green;
  }

  .list_div{
    position: relative;
    width: 100%;
    height: 45vw;
    overflow-y: scroll;
  }

  .list_content{
    position: relative;
    width: 100%;
    height: 300px;
    display: none;
  }

  .list_info{
    font-size: 2vw;
  }

  .register_btn{
    position: fixed;
    width: 10%;
    height: auto;
    left: 70vw;
    background-color: #242424;
    color: white;
    font-size: 24px;
    text-align: center;
  }

  .board_menu_div{
    position: relative;
    width: 25%;
    height: 95%;
    float: left;
    left: 24vw;
  }

  .bookmark{
    position: relative;
    top: 1vw;
    width: 20%;
    height: 5vw;
    background-color: #f4f4f4;
    float: left;
    font-size: 1.5vw;
    text-align: center;
    display: table;
    z-index: 3;
  }

  #bookmark_open{
    background-image: url(../../static/img/arrow.png);
    background-repeat: no-repeat;
    background-size:40% 40%;
    background-position: center;
    border-top-left-radius: 20px 20px;
    border-bottom-left-radius: 20px 20px;
    box-shadow: -2px -2px 2px 2px gray;
  }

  #bookmark_close{
    background-image: url(../../static/img/arrow.png);
    background-repeat: no-repeat;
    background-size:40% 40%;
    background-position: center;
    -webkit-transform:rotate(180deg);
    -moz-transform:rotate(180deg);
    -ms-transform:rotate(180deg);
    -o-transform:rotate(180deg);
    transform:rotate(180deg);
    border-top-right-radius: 20px 20px;
    border-bottom-right-radius: 20px 20px;
    box-shadow: 2px 2px 2px 2px gray;
  }

  .board{
    position: relative;
    width: 60%;
    height: 100%;
    margin-left: 10%;
    float: left;
  }

  .board_menu{
    position: relative;
    width: 80%;
    height: 100%;
    background-color: #f4f4f4;
    float: left;
    text-align: center;
    box-shadow: -2px -2px 2px 2px gray;
  }

  .function_div{
    position: relative;
    width: 100%;
    height: 7vw;
  }

  .buttons{
    position: relative;
    top: 50%;
    -webkit-transform: translate(0%, -50%);
    -ms-transform: translate(0%, -50%);
    -moz-transform: translate(0%, -50%);
    -o-transform: translate(0%, -50%);
    transform: translate(0%, -50%);
    width: 100%;
    height: auto;
    text-align: center;
    margin: auto;
  }

  .btn{
    width: 32%;
    height: 1.5vw;
    float: left;
    margin-right: 1%;
  }

  #mobile_board_menu{
    display: none;
  }

  #web_board_menu{
    display: block;
  }

  .realtime_list_img{
    max-width: 100%;
    height: 10vw;
  }

  .dog_img_div{
    width: 100%;
  }

  .location_name_div{
    width: 80%;
    text-align: left;
    margin: auto;
  }

  .info_span{
    width: 100%;
    font-size: 1vw;
  }

  .realtime_list_content{
    width: 100%;
    float: left;
  }

  .sort_div{
    width: 100%;
    height: 3vw;
  }
/*  end  */
}

@media (max-width:750px) {
      /*  상단 고정 메뉴바 css  */
  
    .top{
      width: 100%;
      position: fixed;     /*  화면상 위치 고정  */

      z-index: 3;          /*  z값 결정  */
      top : 0;
      height: 9vw;
      background-color: white;
    }

    .top_logo{
      position: relative;
      margin-top: 0.5vw;
      margin-left: 50%;
      -webkit-transform: translate(-50%, 0%);
      -ms-transform: translate(-50%, 0%);
      -moz-transform: translate(-50%, 0%);
      -o-transform: translate(-50%, 0%);
      transform: translate(-50%, 0%);
      width: 50%;
      text-align: center;
      font-weight: 900;
    }
    .top_nav{  
      position: relative;
      /*margin-top: 3%;*/    /*  top 여백 설정  */
      width: 100%;
      margin-left: 50%;
      -webkit-transform: translate(-50%, 0%);
      -ms-transform: translate(-50%, 0%);
      -moz-transform: translate(-50%, 0%);
      -o-transform: translate(-50%, 0%);
      transform: translate(-50%, 0%);
      text-align: center;
      margin-top: 1%;
    }
    .menu{
      margin-left: 0.5vw;
      margin-right: 0.5vw;
      color: black;
      font-size: 3.1vw;
      font-weight: 900;
    }
    .menu:hover {
      font-weight: 900;
      font-size: 2vw;
    }
    .top_logo_img{
      width: 28vw;
      height: 4vw;
      margin: 0;
    }
    .menu_slash{
      color: #BDBDBD;
      font-size: 1vw;
    }
    .top_logo_txt{
      font-size: 2vw;
      font-family: 'Clicker Script', cursive;
      color: #B5996D;
    }

    .top_nav a{
      text-decoration: none;
    }

    .top_title{
      width: 100%;
      background-color: white;
      height: 5vw;
      margin-top: 10vw;
    }

    .logo_img_div{
      width: 80%;
      height: 100%;
      background-color: white;
      margin: auto;
      margin-top: 5%;
    }

    html{
    font-size: 62.5%;
  }

  body{
    margin: 0;
  }

/*  end   */
/*  middle  */
  .middle{
    width: 100%;
    height: 70vw;
    background-color: transparent;
    position: relative;
  }

  .map_div{
    position: relative;
    width: 100%;
    height: auto;
    background-color: green;
  }

  .list_div{
    position: relative;
    width: 100%;
    height: 90vw;
    overflow-y: scroll;
  }

  .list_content{
    position: relative;
    width: 100%;
    height: 300px;
    display: none;
  }

  .list_info{
    font-size: 4vw;
  }

  .board{
    position: relative;
    width: 100%;
    height: 100%;
    float: left;
  }

  .board_menu{
    position: relative;
    width: 100%;
    height: 35vw;
    background-color: gray;
    float: left;
  }

  .function_div{
    position: relative;
    width: 100%;
    height: 15vw;
  }

  .buttons{
    position: relative;
    top: 50%;
    -webkit-transform: translate(0%, -50%);
    -ms-transform: translate(0%, -50%);
    -moz-transform: translate(0%, -50%);
    -o-transform: translate(0%, -50%);
    transform: translate(0%, -50%);
    width: 100%;
    height: auto;
    text-align: center;
    margin: auto;
  }

  .btn{

  }

  #web_board_menu{
    display: none;
  }

  #mobile_board_menu{
    display: block;
  }

  .realtime_list_img{
    width: 15vw;
    height: 15vw;
  }

  .dog_img_div{
    width: 100%;
  }

  .location_name_div{
    width: 100%;
  }

  .info_span{
    font-size: 0.5vw;
    text-align: center;
  }

  .realtime_list_content{
    width: 20%;
    float: left;
  }

  .sort_div{
    width: 100%;
    height: 6vw;
  }
/*  end  */
}
  </style>
            <style type="text/css">
            @media (min-width:750px) {
              .pop-up{
                width: 80vw;
                height: 40vw;
                background-color: #f7f1e6;
                z-index: 9999;
                position: fixed;
                left : 50%;
                display: none;
                -webkit-transform: translate(-50%, 0%);
                -ms-transform: translate(-50%, 0%);
                -moz-transform: translate(-50%, 0%);
                -o-transform: translate(-50%, 0%);
                transform: translate(-50%, 0%);
                box-shadow: 10px 10px 10px black;
              }
              .pop_content{
                position: relative;
                width: 90%;
                height: 90%;
                background-color: #f7f1e6;
                left : 50%;
                top: 50%;
                -webkit-transform: translate(-50%, -50%);
                -ms-transform: translate(-50%, -50%);
                -moz-transform: translate(-50%, -50%);
                -o-transform: translate(-50%, -50%);
                transform: translate(-50%, -50%);
              }
              .pop_img_div{
                position: absolute;
                top: 8%;
                z-index: 10;
                width: 30vw;
                height: 30vw;
                text-align: center;
                box-shadow: 2px 2px 2px 2px black;
              }
              .pop_info_div{
                position: relative;
                top: 10%;
                left: 50%;
                width: 50%;
                height: 80%;
                background-color: #f7f1e6;
              }
              #pop_info{
                font-size: 2vw;
                color: #242424;
              }
              .close_btn_div{
                width: 3vw;
                height: 3vw;
                position: fixed;
                top: 0%;
                right: 0%;
                background-image: url(../../static/img/close_btn.png);
                background-repeat: no-repeat;
                background-size:100% 100%;
              }
            }

            @media (max-width:750px) {
              .pop-up{
                width: 90vw;
                height: 60vw;
                background-color: #f7f1e6;
                z-index: 9999;
                position: fixed;
                left : 50%;
                display: none;
                -webkit-transform: translate(-50%, 30%);
                -ms-transform: translate(-50%, 30%);
                -moz-transform: translate(-50%, 30%);
                -o-transform: translate(-50%, 30%);
                transform: translate(-50%, 30%);
                box-shadow: 10px 10px 10px black;
              }
              .pop_content{
                position: relative;
                width: 90%;
                height: 90%;
                background-color: #f7f1e6;
                left : 50%;
                top: 50%;
                -webkit-transform: translate(-50%, -50%);
                -ms-transform: translate(-50%, -50%);
                -moz-transform: translate(-50%, -50%);
                -o-transform: translate(-50%, -50%);
                transform: translate(-50%, -50%);
              }
              .pop_img_div{
               position: absolute;
                top: 13%;
                z-index: 10;
                width: 30vw;
                height: 30vw;
                text-align: center;
                box-shadow: 2px 2px 2px 2px black;
              }
              .pop_info_div{
                position: relative;
                top: 15%;
                left: 40%;
                width: 60%;
                height: 80%;
                background-color: #f7f1e6;
              }

              #pop_info{
                font-size: 4vw;
                color: #242424;
              }

              .close_btn_div{
                width: 6vw;
                height: 6vw;
                position: fixed;
                z-index: 9000;
                top: 0%;
                right: 0%;
                background-image: url(../../static/img/close_btn.png);
                background-repeat: no-repeat;
                background-size:100% 100%;
              }
            }
            </style>
</head>
<body>
  <div class="pop-up">
    <div class="close_btn_div" onclick="pop_close();">
    </div>
    <div class="pop_content">
      <div class="pop_img_div">
        <img id="pop_img" src="" style="width: 100%; height: 100%;">
      </div>
      <div class="pop_info_div">
        <span id="pop_info" style="=">
          이름 : <span id="pop_info_name"></span><br>
          위치 : <span id="pop_info_location"></span><br>
          잃어버린 날짜 : <span id="pop_info_losted_at"></span><br>
          등록 날짜 :<span id="pop_info_created_at"></span><br>
          특징 : <span id="pop_info_feature"></span><br>
          사례금 : <span id="pop_info_reward"></span><br>
          연락처 : <span id="pop_info_phone"></span>
        </span>
      </div>
    </div>
  </div>


  <div class='top'>
      <div class='top_logo'>
        <img class='top_logo_img' src="../../static/img/logo_txt_color.png">  
      </div>
      <div class='top_nav'>
        <a href="../"><span class="menu" id="w"> HOME </span></a>
        <span class='menu_slash'> / </span>
        <a href="../matching"><span class="menu" id="tmp"> 강아지매칭 </span></a>
        <span class='menu_slash'> / </span>
        <a href="../notice"><span class="menu" id="h"> 실종신고 </span></a>
        <span class='menu_slash'> / </span>
        <a href="../stats"><span class="menu" id="h"> 통개자료 </span></a>
        <span class='menu_slash'> / </span>
        <a href="../shelter"><span class="menu" id="h"> 보호소 </span></a>
        <span class='menu_slash'> / </span>
        <a href="../donator"><span class="menu" id="h"> 멍예의전당 </span></a>
        <span class='menu_slash'> / </span>
        <a href="../about_us"><span class="menu"> ABOUT US </span></a>
      </div>
  </div>

    <div class="top_title">
      <div class="logo_img_div">
        <p style="font-size: 1.5vw; font-weight: 900;">
        <img src="../../static/img/logo_img_color.png" align="middle" style="width: 5vw; height: auto;">
        실종신고

        </p>
      </div>
    </div>

    <div class='middle'>
      <div class='board_menu' id="mobile_board_menu">
        <a href="../register_dog"><button>잃어버린 강아지 등록하기</button></a>
        <br>
        <span style="font-size: 2vw; color: white;"> 최근 등록 강아지 </span>
        <div class='realtime_list'>
          
        </div>
      </div>


      <div class='board'>
        <div class='map_div'>
          <div id="floating-panel">
            <input id="address" type="textbox" value="">
            <br>
            <input id="submit" type="button" value="검색">
            <button onclick="my_location()">my location</button>
            <select id="distance_select">
              <option value="1">1km</option>
              <option value="3">3km</option>
              <option value="5">5km</option>
            </select>
          </div>
          <div id="map"></div>
        </div>

        <div class='function_div'>
          <div class='buttons'>
            <a href="../take_dog"><button class="btn"> 데리고 있어요 </button></a>
            <a href="../notice"><button  class="btn"> 잃어버렸어요 </button></a>
            <a href="../complete_dog"><button  class="btn"> 찾았어요 </button></a>
            <br><br><br>
            <div class="sort_div">
              <div id="sort_by_search_content" style="width: 40%; float: left; border: 1px solid #242424; font-size: 15px;">
                <div style="width: 50%; float: left;">
                  강아지이름 :
                </div>
                <div style="width: 50%; float: left;">
                  <input type="text" id="dog_name_input" style="width: 95%;">
                </div>

                <br>

                <div style="width: 50%; float: left;">
                  연락처 :
                </div>
                <div style="width: 50%; float: left;">
                  <input type="text" id="dog_phone_input" style="width: 95%;">
                </div>
              </div>
              <div id="sort_by_search_div" onclick="sort_by_search();" style="width: 10%; float: left; border: 1px solid #242424; font-size: 15px;">
                게시물찾기
              </div>


              <div id="sort_by_location_div" onclick="sort_by_all();" style="width: 10%; float: right; border: 1px solid #242424; font-size: 15px;">
                전체
              </div>
              <span  style="width: 5%; float: right;  font-size: 15px;"> / </span>

              <div id="sort_by_location_div" onclick="sort_by_location();" style="width: 10%; float: right; border: 1px solid #242424; font-size: 15px;">
                거리순
              </div>
              <span  style="width: 5%; float: right;  font-size: 15px;"> / </span>
              <div id="sort_by_latset_div" onclick="sort_by_latest();"  style="width: 10%; float: right; border: 1px solid #242424;  font-size: 15px;">
                최신등록순
              </div>
            </div>
            <button class="btn" style="display: none;"> 입양소에 있어요 </button>
          </div>
        </div>

        <div class='list_div'>
          <div class="list_info">
            <span>
              위의 지도에서 지역을 검색하시면 거리기반 리스트가 나옵니다.
            </span>
          </div>
          {% for dog in dogs %}
            <div class='list_content' id="lc{{dog.pk}}">
              <div class='dog_img_div' style="width: 30%; float: left;">
                <img src="{{dog.img_src}}" style="max-width: 100%; height: 200px;">
              </div>
              <div class='location_name_div' style="width: 50%; float: left;">
                <span style="font-size: 20px;">
                  번호 : {{dog.pk}}<br>
                  위치 : {{dog.location_name}}<br>
                  이름 : {{dog.dog_name}}<br>
                  잃어버린 날짜 : {{dog.losted_at}}<br>
                  등록 날짜 : {{dog.created_at}}<br>
                  특징 : {{dog.feature}}<br>
                  사례금 : {{dog.reward}}<br>
                  연락처 : {{dog.phone}}
                </span>
              </div>
              <div class='button_div' style="width: 20%; float: left;">
                비밀번호 : <input type="text" id="psw_txt{{dog.pk}}" name="psw_txt"><br>
                <button id="ch_btn_{{dog.pk}}" onclick="change_marker(this.id)">수정</button>
                <button id="del_btn_{{dog.pk}}" onclick="delete_marker(this.id)">삭제</button>
                <button id="complete_btn_{{dog.pk}}" onclick="complete_marker(this.id)">완료</button>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <a href="../register_dog">
        <div class="register_btn">
          잃어버린 <br>
          강아지 <br>
          등록하기
        </div>
      </a>
      <div class="board_menu_div">

          <div class="bookmark" id="bookmark_open" onclick="open_div();">
              
          </div>
          <div class="bookmark" id="bookmark_close" onclick="close_div();" style="display: none;">
            
          </div>


            <div class='board_menu'  id="web_board_menu">
              <br>
              <span style="font-size: 2vw;"> 최신 등록 리스트 </span>
              <div class='realtime_list'>
                
              </div>
            </div>
      </div>
    </div>


    <script>
              var x_marker_list = {};
              var y_marker_list = {};
              var img_marker_list = {};

              var list_by_location = [];

              var distance_val = 3;
              var cityCircle;

              function select_val(){
                  var t = $('#distance_select').val();
                  distance_val = t;
              }

              function distance(lat1, lon1, lat2, lon2, unit) {
                var radlat1 = Math.PI * lat1/180
                var radlat2 = Math.PI * lat2/180
                var theta = lon1-lon2
                var radtheta = Math.PI * theta/180
                var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
                dist = Math.acos(dist)
                dist = dist * 180/Math.PI
                dist = dist * 60 * 1.1515
                if (unit=="K") { dist = dist * 1.609344 }
                if (unit=="N") { dist = dist * 0.8684 }
                return dist
              }

              function my_location(){
                  $('.list_info').css('display', 'none');
                  var map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: -34.397, lng: 150.644},
                    zoom: 12
                  });
                  var infoWindow = new google.maps.InfoWindow({map: map});


                  // Try HTML5 geolocation.
                  if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                      var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                      };
                      select_val();
                      if(marker){
                        marker.setMap(null);
                      }
                      marker = new google.maps.Marker({
                        map: map,
                        position: pos               
                      });

                      if(cityCircle){
                      cityCircle.setMap(null);
                      }
                      cityCircle = new google.maps.Circle({
                        strokeColor: '#FF0000',
                        strokeOpacity: 0.8,
                        strokeWeight: 2,
                        fillColor: '#FF0000',
                        fillOpacity: 0.35,
                        map: map,
                        center: pos,
                        radius: distance_val * 1000
                      });

                      infoWindow.setPosition(pos);
                      infoWindow.setContent('Location found.');
                      map.setCenter(pos);
                      

                      var icon = {

                      };

                      for(var key in img_marker_list){
                        icon[key] = { url: img_marker_list[key], // url
                                      scaledSize: new google.maps.Size(30, 30), // scaled size
                                      origin: new google.maps.Point(0,0), // origin
                                      anchor: new google.maps.Point(0, 0) // anchor
                                    };
                      }

                      //console.log(icon);

                      var features = [
                     
                      ];

                      for(var key in x_marker_list){
                        features.push({
                          position: new google.maps.LatLng(x_marker_list[key], y_marker_list[key]),
                          type: 'puppy',
                          pk : key
                        });
                      }
                      

                      //console.log(features);

                      // Create markers.
                      features.forEach(function(feature) {
                        var marker = new google.maps.Marker({
                          position: feature.position,
                          icon: icon[feature.pk],
                          animation: google.maps.Animation.DROP,
                          map: map
                        });

                        //console.log(icon[feature.pk]);

                        marker.addListener('click', function() {
                          map.setZoom(15);
                          map.setCenter(marker.getPosition());
                          //alert("click event");
                          info_popup(feature.pk);
                        });
                        marker.addListener('click', toggleBounce);
                        function toggleBounce() {
                          if (marker.getAnimation() !== null) {
                            marker.setAnimation(null);
                          } else {
                            marker.setAnimation(google.maps.Animation.BOUNCE);
                          }
                        }
                      });

                      //alert(distance(x_marker_list[0], y_marker_list[0], x_marker_list[1], y_marker_list[1], 'K'));
                      
                      list_by_location = [];
                        for(var key in x_marker_list){
                          var dist = distance(x_marker_list[key], y_marker_list[key], position.coords.latitude ,position.coords.longitude, 'K');
                          var tmp = [];
                          if(dist <= distance_val){
                            $('#lc' + key.trim()).css('display','block');
                            tmp.push(key);
                            tmp.push(dist);
                            list_by_location.push(tmp);
                          }
                          else{
                            $('#lc' + key.trim()).css('display','none');
                          }
                        }
  

                            }, function() {
                              handleLocationError(true, infoWindow, map.getCenter());
                            });
                          } else {
                            // Browser doesn't support Geolocation
                            handleLocationError(false, infoWindow, map.getCenter());
                          }

                        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                          infoWindow.setPosition(pos);
                          infoWindow.setContent(browserHasGeolocation ?
                                                'Error: The Geolocation service failed.' :
                                                'Error: Your browser doesn\'t support geolocation.');
                        }
              }


              function initMap() {
                var markers = '{{ markers|escapejs }}';

                var map_var = document.getElementById('map');

                console.log(map_var);
                
                var map = new google.maps.Map(map_var, {
                  zoom: 10,
                  center: new google.maps.LatLng(37.49, 127.02),
                  mapTypeId: 'roadmap'
                });

                while(markers.length > 0){
                  //console.log(markers);
                  pk_position_start = markers.indexOf('"pk');
                  pk_tmp = markers.substring(pk_position_start+5, markers.length);
                  //alert(pk_tmp);
                  pk_position_end = pk_tmp.indexOf(',');
                  pk_position = pk_tmp.substring(0, pk_position_end);
                  //alert(pk_position);

                  pk_str = String(pk_position).trim();
                  //alert(pk_str);


                  img_position_start = markers.indexOf('"img_src');
                  img_tmp = markers.substring(img_position_start+11, markers.length);
                  //alert(img_tmp);
                  img_tmp_end = img_tmp.indexOf(',');
                  img_postion = img_tmp.substring(1, img_tmp_end-1);
                  //alert(img_postion);
                  if(pk_str.length > 0){
                    img_marker_list[pk_str] = img_postion;
                  }



                  x_position_start = markers.indexOf('"x');
                  x_tmp = markers.substring(x_position_start+4, markers.length);
                  //alert(x_tmp);
                  x_position_end = x_tmp.indexOf(',');
                  x_position = x_tmp.substring(0, x_position_end);
                  //alert(x_position);
                  //x_marker_list.push(x_position);

          
                  if(pk_str.length > 0){
                    x_marker_list[pk_str] = x_position;
                  }


                  y_position_start = markers.indexOf('"y');
                  y_tmp = markers.substring(y_position_start+4, markers.length);
                  //alert(y_tmp);
                  y_position_end = y_tmp.indexOf(',');
                  y_position = y_tmp.substring(0, y_position_end);
                  //alert(y_position);
                  //y_marker_list.push(y_position);
                  if(pk_str.length > 0){
                    y_marker_list[pk_str] = y_position;
                  }

                  markers = y_tmp.substring(y_position_end, markers.length);
                }
                //console.log(img_marker_list);
                //alert(x_marker_list);
                //console.log(x_marker_list);
                /*
                var iconBase = '../../static/img/';
                var icons = {
                  puppy: {
                    icon: iconBase + 'puppy_footprint2.png'
                  }
                };
                */

                /*
                var icon = {
                    url: "../../static/img/puppy_footprint2.png", // url
                    scaledSize: new google.maps.Size(25, 25), // scaled size
                    origin: new google.maps.Point(0,0), // origin
                    anchor: new google.maps.Point(0, 0) // anchor
                };
                */

                var icon = {

                };

                for(var key in img_marker_list){
                  icon[key] = { url: img_marker_list[key], // url
                                scaledSize: new google.maps.Size(30, 30), // scaled size
                                origin: new google.maps.Point(0,0), // origin
                                anchor: new google.maps.Point(0, 0) // anchor
                              };
                }

                //console.log(icon);

                var features = [
               
                ];

                for(var key in x_marker_list){
                  features.push({
                    position: new google.maps.LatLng(x_marker_list[key], y_marker_list[key]),
                    type: 'puppy',
                    pk : key
                  });
                }
                

                //console.log(features);

                // Create markers.
                features.forEach(function(feature) {
                  var marker = new google.maps.Marker({
                    position: feature.position,
                    icon: icon[feature.pk],
                    animation: google.maps.Animation.DROP,
                    map: map
                  });

                  //console.log(icon[feature.pk]);

                  marker.addListener('click', function() {
                    map.setZoom(15);
                    map.setCenter(marker.getPosition());
                    //alert("click event");
                    info_popup(feature.pk);
                  });
                  marker.addListener('click', toggleBounce);
                  function toggleBounce() {
                    if (marker.getAnimation() !== null) {
                      marker.setAnimation(null);
                    } else {
                      marker.setAnimation(google.maps.Animation.BOUNCE);
                    }
                  }
                });

                var geocoder = new google.maps.Geocoder();

                document.getElementById('submit').addEventListener('click', function() {
                  geocodeAddress(geocoder, map);
                });
              }

              var marker;
              function geocodeAddress(geocoder, resultsMap) {
                $('.list_info').css('display', 'none');
                var address = document.getElementById('address').value;
                geocoder.geocode({'address': address}, function(results, status) {
                  if (status === 'OK') {
                    resultsMap.setCenter(results[0].geometry.location);
                    resultsMap.setZoom(12);
                    select_val();
                    if(marker){
                      marker.setMap(null);
                    }
                    marker = new google.maps.Marker({
                      map: resultsMap,
                      position: results[0].geometry.location               
                    });

                    if(cityCircle){
                      cityCircle.setMap(null);
                    }
                    cityCircle = new google.maps.Circle({
                      strokeColor: '#FF0000',
                      strokeOpacity: 0.8,
                      strokeWeight: 2,
                      fillColor: '#FF0000',
                      fillOpacity: 0.35,
                      map: resultsMap,
                      center: results[0].geometry.location,
                      radius: distance_val * 1000
                    });
                    

                  list_by_location = [];
                  for(var key in x_marker_list){
                    var dist = distance(x_marker_list[key], y_marker_list[key], results[0].geometry.location.lat() , results[0].geometry.location.lng(), 'K');
                    var tmp = [];
                    if(dist <= distance_val){
                      $('#lc' + key.trim()).css('display','block');
                      tmp.push(key);
                      tmp.push(dist);
                      list_by_location.push(tmp);
                    }
                    else{
                      $('#lc' + key.trim()).css('display','none');
                    }
                  }

                  } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                  }
                });
              }











              function sort_by_location(){
                  for(var i=0;i<list_by_location.length-1;i++){
                    for(var j=i+1;j<list_by_location.length;j++){
                      if(list_by_location[i][1] >= list_by_location[j][1]){
                        var tmp = list_by_location[i];
                        list_by_location[i] = list_by_location[j];
                        list_by_location[j] = tmp;
                      }
                    }
                  }

                  for(var i=0;i<list_by_location.length;i++){
                    $('#lc' + list_by_location[i][0]).appendTo($('.list_div'));
                  }

                  var address = document.getElementById('address').value;
                  if(address.length == 0){
                    alert("위 지도에서 '검색' 혹은 '내위치' 로 지역을 지정하시고 이용해주세요.");
                  }
              }

              function sort_by_latest(){
                  for(var i=0;i<list_by_location.length-1;i++){
                    for(var j=i+1;j<list_by_location.length;j++){
                      if(list_by_location[i][0] <= list_by_location[j][0]){
                        var tmp = list_by_location[i];
                        list_by_location[i] = list_by_location[j];
                        list_by_location[j] = tmp;
                      }
                    }
                  }

                  for(var i=0;i<list_by_location.length;i++){
                    $('#lc' + list_by_location[i][0]).appendTo($('.list_div'));
                  }

                  var address = document.getElementById('address').value;
                  if(address.length == 0){
                    alert("위 지도에서 '검색' 혹은 '내위치' 로 지역을 지정하시고 이용해주세요.");
                  }
              }


              function sort_by_all(){
                var obj = document.getElementsByClassName('list_content');
                var pk_list = [];

                for(var i=0;i<obj.length;i++){
                  pk_list.push(obj[i].id.substring(2,obj[i].id.length));
                }

                for(var i=0;i<pk_list.length-1;i++){
                  for(var j=i+1;j<pk_list.length;j++){
                    if(pk_list[i] <= pk_list[j]){
                      var tmp = pk_list[i];
                      pk_list[i] = pk_list[j];
                      pk_list[j] = tmp;
                    }
                  }
                }

                //console.log(pk_list);

                $('.list_info').css('display', 'none');

                for(var i=0;i<pk_list.length;i++){
                  $('#lc' + pk_list[i]).appendTo($('.list_div'));
                  $('#lc' + pk_list[i]).css('display', 'block');
                }

              }




              function sort_by_search(){
                var input_name_val = $('#dog_name_input').val();
                var input_phone_val = $('#dog_phone_input').val();

                if(input_name_val.length == 0 && input_phone_val.length == 0){
                  alert("값을 입력해주세요!");
                }

                else if(input_name_val.length != 0 && input_phone_val.length == 0){
                  $.ajax({
                      url: '/sort_by_search/',
                      data: {
                        'dog_name' : input_name_val
                      },
                      dataType: 'json',
                      success: function (data) {
                        $('.list_content').css('display', 'none');
                        for(var i=0;i<data.pk_list.length;i++){
                          $('#lc' + String(data.pk_list[i])).css('display', 'block');
                        }
                      }
                  });
                }

                else if(input_name_val.length == 0 && input_phone_val.length != 0){
                  $.ajax({
                      url: '/sort_by_search/',
                      data: {
                        'dog_phone' : input_phone_val
                      },
                      dataType: 'json',
                      success: function (data) {
                        $('.list_content').css('display', 'none');
                        for(var i=0;i<data.pk_list.length;i++){
                          $('#lc' + String(data.pk_list[i])).css('display', 'block');
                        }
                      }
                  });
                }

                else if(input_name_val.length != 0 && input_phone_val.length != 0){
                  $.ajax({
                      url: '/sort_by_search/',
                      data: {
                        'dog_name' : input_name_val,
                        'dog_phone' : input_phone_val
                      },
                      dataType: 'json',
                      success: function (data) {
                        $('.list_content').css('display', 'none');
                        for(var i=0;i<data.pk_list.length;i++){
                          $('#lc' + String(data.pk_list[i])).css('display', 'block');
                        }
                      }
                  });
                }
              }







      function open_div(){
        $('.board_menu_div').animate({
          "left" : "-1vw"
        });
        $('#bookmark_open').css('display', 'none');
        $('#bookmark_close').css('display', 'block');
      }

      function close_div(){
        $('.board_menu_div').animate({
          "left" : "24vw"
        });
        $('#bookmark_open').css('display', 'block');
        $('#bookmark_close').css('display', 'none');
      }

      function pop_close(){
        $('.pop-up').css('display', 'none');
        $('.top').css({
            '-webkit-filter': 'blur(0px)',
            '-moz-filter': 'blur(0px)',
            '-o-filter': 'blur(0px)',
            '-ms-filter': 'blur(0px)',
            'filter': 'blur(0px)'
        });
        $('.top_title').css({
            '-webkit-filter': 'blur(0px)',
            '-moz-filter': 'blur(0px)',
            '-o-filter': 'blur(0px)',
            '-ms-filter': 'blur(0px)',
            'filter': 'blur(0px)'
        });
        $('.middle').css({
            '-webkit-filter': 'blur(0px)',
            '-moz-filter': 'blur(0px)',
            '-o-filter': 'blur(0px)',
            '-ms-filter': 'blur(0px)',
            'filter': 'blur(0px)'
        });
      }

      function info_popup(pk){
        //alert(pk);
        $.ajax({
                      url: '/show_info/',
                      data: {
                        'pk_id' : pk
                      },
                      dataType: 'json',
                      success: function (data) {
                        $('#pop_img').attr('src', data.img_src);
                        $('#pop_info_location').html(data.location_name);
                        $('#pop_info_name').html(data.dog_name);
                        $('#pop_info_losted_at').html(data.losted_at);
                        $('#pop_info_created_at').html(data.created_at);
                        $('#pop_info_feature').html(data.feature);
                        $('#pop_info_phone').html(data.phone);
                        $('#pop_info_reward').html(data.reward);


                        $('.top').css({
                          '-webkit-filter': 'blur(4px)',
                          '-moz-filter': 'blur(4px)',
                          '-o-filter': 'blur(4px)',
                          '-ms-filter': 'blur(4px)',
                          'filter': 'blur(4px)'
                        });
                        $('.top_title').css({
                          '-webkit-filter': 'blur(4px)',
                          '-moz-filter': 'blur(4px)',
                          '-o-filter': 'blur(4px)',
                          '-ms-filter': 'blur(4px)',
                          'filter': 'blur(4px)'
                        });
                        $('.middle').css({
                          '-webkit-filter': 'blur(4px)',
                          '-moz-filter': 'blur(4px)',
                          '-o-filter': 'blur(4px)',
                          '-ms-filter': 'blur(4px)',
                          'filter': 'blur(4px)'
                        });



                        $('.pop-up').fadeIn(1000);
                        $('.pop-up').css({
                          '-webkit-filter': 'blur(0px)',
                          '-moz-filter': 'blur(0px)',
                          '-o-filter': 'blur(0px)',
                          '-ms-filter': 'blur(0px)',
                          'filter': 'blur(0px)'
                        });
                      }
              });
      }

      /*  scroll 이벤트 관리 변수 */
    var flag1 = 0;
    var flag2 = 0;
    var flag3 = 0;

    $(document).ready(function(){
      updateData();
    });


    function updateData(){
      var location_name_list = [];
      var dog_name_list = [];
      var img_src_list = [];
      var pk_list = [];

      $.ajax({
        url: '/updateData/',
        data: {
          
        },
        dataType: 'json',
        success: function (data) {
          //alert("!!!!!");
          //console.log(data.dogs);
          var total = data.dogs;
          while(total.length > 0){
            var pk_idx = total.indexOf("pk");
            var tm = total.substring(pk_idx+5, total.length);

            var idx1 = tm.indexOf(",");
            var pk = tm.substring(0, idx1);

            var location_name_idx = total.indexOf("location_name");
            if(location_name_idx <= 0){
              break;
            }
            var tmp = total.substring(location_name_idx+17, total.length);

            idx1 = tmp.indexOf(",");
            var location_name = tmp.substring(0,idx1-1);


            var dog_name_idx = tmp.indexOf("dog_name");
            var tmp2 = tmp.substring(dog_name_idx+12, total.length);

            idx1 = tmp2.indexOf(",");
            var dog_name = tmp2.substring(0,idx1-1);



            var img_src_idx = tmp2.indexOf("img_src");
            var tmp3 = tmp2.substring(img_src_idx+11, total.length);

            idx1 = tmp3.indexOf(",");
            var img_src = tmp3.substring(0,idx1-1);

            pk_list.push(pk);
            location_name_list.push(location_name);
            dog_name_list.push(dog_name);
            img_src_list.push(img_src);

            total = tmp3;
          }

          var content = '';

          var end_idx = 0;
          if(location_name_list.length < 5){
            end_idx = location_name_list.length;
          }

          else{
            end_idx = 5;
          }

          for(var i=location_name_list.length-1;i>=location_name_list.length-end_idx;i--){
            if(location_name_list.length == 0){
              break;
            }
            var a = "<div class='realtime_list_content' id=\"" + pk_list[i] +"\" onclick=\"info_popup(this.id);\"><div class='dog_img_div' style=\"\"><img class=\"realtime_list_img\" src=";
            var b = "\"" + img_src_list[i] + "\"" +  "style=\"\"></div>";
            var c = "<div class='location_name_div' id=\"location_name_div\" style=\"\">";
            var d = "<span class=\"info_span\" style=\"\">";
            var e = "위치 : " + location_name_list[i] + "<br>이름 : " + dog_name_list[i];
            var f = "</span></div></div>";

            content = content + a + b + c + d + e + f;
          }

          $('.realtime_list').html(content);
        }
      });
      setTimeout("updateData()",2000);
    }

$(window).scroll(function () {

                var w = $(window).width();

                //alert(w);

                /*  scroll 값  */
                var height = $(document).scrollTop();


                //alert(w);

                if(w > 500){

                    /*  상단 고정 메뉴바 이벤트  */
                    if(height > 100){
                        if(flag3==0){
                            $('.top').css("background-color", "#B5996D");
                            $('.top_logo_img').attr("src", "../../static/img/logo_txt_white.png");
                            //$('.top_logo_txt').animate({fontSize: '1.3rem'}, "fast");
                            $('.menu').css("color", "#ffffff");
                            
                            $('.top_logo').animate({
                                marginLeft : '10%',
                            });

                            $('.top_nav').animate({
                                marginLeft : '80%',
                                marginTop : '-2%'
                            });

                            $('.top').animate({
                                height : '3vw',
                            });

                            $('.top_nav').css({
                                /*
                                '-webkit-transform' : 'translate(-50%, 0%)',
                                '-ms-transform' : 'translate(-50%, 0%)',
                                '-moz-transform' : 'translate(-50%, 0%)',
                                '-o-transform' : 'translate(-50%, 0%)',
                                'transform' : 'translate(-50%, 0%)'
                                */
                            });
                            
                            flag3=1;
                        }
                    }

                    if(height < 100){
                        if(flag3==1){
                            $('.top').css("background-color", "white");
                            $('.top_logo_img').attr("src", "../../static/img/logo_txt_color.png");
                            //$('.top_logo_txt').animate({fontSize: '1rem'}, "fast");
                            $('.menu').css("color", "black");
                            

                            $('.top_logo').animate({
                                marginLeft : '50%',
                            });

                            $('.top_nav').animate({
                                marginLeft: '50%',
                                marginTop : '1%'
                            });

                            $('.top').animate({
                                height : '5vw',
                            });

                            $('.top_nav').css({
                                '-webkit-transform' : 'translate(-50%, 0%)',
                                '-ms-transform' : 'translate(-50%, 0%)',
                                '-moz-transform' : 'translate(-50%, 0%)',
                                '-o-transform' : 'translate(-50%, 0%)',
                                'transform' : 'translate(-50%, 0%)'
                            });
                            flag3=0;
                        }
                    }
                }


                if(w < 500){
                    if(height > 100){
                        $('.top').css({
                                '-webkit-transform' : 'translate(0%, -50%)',
                                '-ms-transform' : 'translate(0%, -50%)',
                                '-moz-transform' : 'translate(0%, -50%)',
                                '-o-transform' : 'translate(0%, -50%)',
                                'transform' : 'translate(0%, -50%)'
                            });
                    }

                    if(height < 100){
                        $('.top').css({
                                '-webkit-transform' : 'translate(0%, 0%)',
                                '-ms-transform' : 'translate(0%, 0%)',
                                '-moz-transform' : 'translate(0%, 0%)',
                                '-o-transform' : 'translate(0%, 0%)',
                                'transform' : 'translate(0%, 0%)'
                            });
                    }
                }
});


       function register_dog(){

                var geocoder = new google.maps.Geocoder();

                  document.getElementById('submit').addEventListener('click', function() {
                    geocodeAddress(geocoder, map);
                  });

                var address = document.getElementById('address').value;
                geocoder.geocode({'address': address}, function(results, status) {
                  if (status === 'OK') {
                    $.ajax({
                      url: '/register_marker/',
                      data: {
                        'location_name': document.getElementById('address').value,
                        'x' : results[0].geometry.location.lat(),
                        'y' : results[0].geometry.location.lng(),
                        'image_src' : document.getElementById('id_image').value,
                        'dog_name' : document.getElementById('id_dog_name').value
                      },
                      dataType: 'json',
                      success: function (data) {
                        alert(data.result);
                      }
                    });

                  } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                  }
                });
        }


        function delete_marker(btn_id){
          //alert(btn_id);
          var btn_id_str = String(btn_id);
          var pk_id = btn_id_str.substring(8, btn_id_str.length);

          var psw_txt = $("#psw_txt" + pk_id).val();
          //alert(psw_txt);

          //alert(pk_id);
          
                    $.ajax({
                      url: '/delete_marker/',
                      data: {
                        'pk_id' : pk_id,
                        'psw_txt' : psw_txt
                      },
                      dataType: 'json',
                      success: function (data) {
                        alert(data.result);
                        location.reload();
                      }
                    });
            
          }

          function change_marker(btn_id){
            var btn_id_str = String(btn_id);
            var pk_id = btn_id_str.substring(7, btn_id_str.length);

            var psw_txt = $("#psw_txt" + pk_id).val();

            $.ajax({
                      url: '/change_marker/',
                      data: {
                        'pk_id' : pk_id,
                        'psw_txt' : psw_txt
                      },
                      dataType: 'json',
                      success: function (data) {
                        alert(data.result);
                        if(data.result == 'success'){
                          window.location.replace("../register_dog/"+String(pk_id));
                        }
                      }
            });
          }


          function complete_marker(btn_id){
            var btn_id_str = String(btn_id);
            var pk_id = btn_id_str.substring(13, btn_id_str.length);

            var psw_txt = $("#psw_txt" + pk_id).val();

            $.ajax({
                      url: '/complete_marker/',
                      data: {
                        'pk_id' : pk_id,
                        'psw_txt' : psw_txt
                      },
                      dataType: 'json',
                      success: function (data) {
                        if(data.result == 'success'){
                          alert(data.result);
                          location.reload();
                        }
                      }
            });
          }
            </script>

            <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA_E5Ls2VQ_yDsadA9-KhCLTBFoJ6AxuJo&callback=initMap">
            </script>
</body>
</html>